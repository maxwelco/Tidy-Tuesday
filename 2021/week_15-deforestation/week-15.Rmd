---
title: "week-15"
author: "Maxwel Coura Oliveira"
date: "4/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
tuesdata <- tidytuesdayR::tt_load(2021, week = 15)

forest_change <- tuesdata$forest
forest_area <- tuesdata$forest_area
brazil_loss <- tuesdata$brazil_loss
soybean_use <- tuesdata$soybean_use
vegetable_oil <- tuesdata$vegetable_oil
```


```{r}
forest_change %>% 
  distinct(entity)
```


```{r}
library(dplyr)
library(ggplot2)
library(ggrepel)
library(tidyverse)
library(ggthemes)
library(ggtext)
```


```{r}
options(scipen = 999)
forest_change %>%
  group_by(entity) %>% 
  summarise(net_forest_conversion = sum(net_forest_conversion)) %>% 
  mutate(highlight = if_else(entity %in% c("Brazil", "China"), TRUE, FALSE),
         variable_col = if_else(highlight == TRUE, entity, "NA")) %>% 
  filter(!entity %in% "World") %>% 
  ggplot(aes(x = reorder(entity, net_forest_conversion), y = net_forest_conversion, 
              fill = variable_col, label = entity)) +
  geom_col() + 
  geom_label_repel(box.padding   = 0.5, 
                  point.padding = 0.2) +
  scale_fill_manual(values = c("#009C3B", "#FF0000", "#9c9c8d")) +
  labs(x = "", y = "Net forest conversion in hectares") +
  theme_void() +
  theme(legend.position = "none",
        axis.text.x = element_blank(),
        axis.ticks = element_blank())
```

```{r}
soybean_use %>% 
  filter(code %in% c("BRA", "CHN")) %>% 
  pivot_longer(cols = human_food:processed, names_to = "soybean_use",
               values_to = "value") %>% 
  group_by(year, entity) %>% 
  mutate(sum = sum(value),
         perc = value / sum * 100)  %>% 
  ggplot(aes(x = year, y = perc, fill = soybean_use)) +
  geom_col() +
  facet_grid(~ entity)
```

  
  geom_point() +
  facet_grid(~ entity)

```{r}
bra_forest_area <- forest_area %>% 
  filter(code == "BRA") 

bra_forest_change <- forest_change %>% 
  filter(code== "BRA")

brachn_soybean_use <- soybean_use %>% 
  filter(code %in% "BRA")

brazil_loss

bra_vegetable_oil <- vegetable_oil %>% 
  filter(code== "BRA")
```


```{r}
brazil_data <- brazil_loss %>% 
  right_join(forest_area, by = c("entity", "code", "year")) %>% 
  left_join(forest_change, by = c("entity", "code", "year")) %>% 
  left_join(soybean_use, by = c("entity", "code", "year")) %>% 
  left_join(vegetable_oil, by = c("entity", "code", "year"))
```


```{r}
brazil_data %>% 
  pivot_longer(cols = commercial_crops:small_scale_clearing, names_to = "type", values_to = "forest_loss") %>% 
  pivot_longer(cols = human_food:processed, names_to = "soybean_use", values_to = "soybean_use_ha")
```


geom_parallel_sets

```{r}
df <- mtcars %>%
  make_long(cyl, vs, am, gear, carb)

ggplot(df, aes(x = x, 
               next_x = next_x, 
               node = node, 
               next_node = next_node,
               fill = factor(node))) +
  geom_sankey()
```

